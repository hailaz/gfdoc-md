<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡ | GoFrame</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://goframe.org/gfdoc-md/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://goframe.org/gfdoc-md/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://goframe.org/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡ | GoFrame"><meta data-rh="true" name="description" content="ä» GoFrame ORM æ”¯æŒæ•°æ®åº“åµŒå¥—äº‹åŠ¡ï¼ŒåµŒå¥—äº‹åŠ¡åœ¨ä¸šåŠ¡é¡¹ç›®ä¸­ç”¨å¾—æ¯”è¾ƒå¤šï¼Œç‰¹åˆ«æ˜¯ä¸šåŠ¡æ¨¡å—ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ï¼Œä¿è¯å„ä¸ªä¸šåŠ¡æ¨¡å—çš„æ•°æ®åº“æ“ä½œéƒ½å¤„äºä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå…¶åŸç†æ˜¯é€šè¿‡ä¼ é€’çš„ context ä¸Šä¸‹æ–‡æ¥éšå¼ä¼ é€’å’Œå…³è”åŒä¸€ä¸ªäº‹åŠ¡å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°æ®åº“æœåŠ¡å¾€å¾€å¹¶ä¸æ”¯æŒåµŒå¥—äº‹åŠ¡ï¼Œè€Œæ˜¯ä¾é  ORM ç»„ä»¶å±‚é€šè¿‡ Transaction Save Point ç‰¹æ€§å®ç°çš„ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ Transaction é—­åŒ…æ–¹æ³•æ¥å®ç°åµŒå¥—äº‹åŠ¡æ“ä½œã€‚ä¸ºäº†ä¿è¯æ–‡æ¡£çš„å®Œæ•´æ€§ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œä»ç„¶ä»æœ€åŸºæœ¬çš„äº‹åŠ¡æ“ä½œæ–¹æ³•å¼€å§‹æ¥ä»‹ç»åµŒå¥—äº‹åŠ¡æ“ä½œã€‚"><meta data-rh="true" property="og:description" content="ä» GoFrame ORM æ”¯æŒæ•°æ®åº“åµŒå¥—äº‹åŠ¡ï¼ŒåµŒå¥—äº‹åŠ¡åœ¨ä¸šåŠ¡é¡¹ç›®ä¸­ç”¨å¾—æ¯”è¾ƒå¤šï¼Œç‰¹åˆ«æ˜¯ä¸šåŠ¡æ¨¡å—ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ï¼Œä¿è¯å„ä¸ªä¸šåŠ¡æ¨¡å—çš„æ•°æ®åº“æ“ä½œéƒ½å¤„äºä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå…¶åŸç†æ˜¯é€šè¿‡ä¼ é€’çš„ context ä¸Šä¸‹æ–‡æ¥éšå¼ä¼ é€’å’Œå…³è”åŒä¸€ä¸ªäº‹åŠ¡å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°æ®åº“æœåŠ¡å¾€å¾€å¹¶ä¸æ”¯æŒåµŒå¥—äº‹åŠ¡ï¼Œè€Œæ˜¯ä¾é  ORM ç»„ä»¶å±‚é€šè¿‡ Transaction Save Point ç‰¹æ€§å®ç°çš„ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ Transaction é—­åŒ…æ–¹æ³•æ¥å®ç°åµŒå¥—äº‹åŠ¡æ“ä½œã€‚ä¸ºäº†ä¿è¯æ–‡æ¡£çš„å®Œæ•´æ€§ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œä»ç„¶ä»æœ€åŸºæœ¬çš„äº‹åŠ¡æ“ä½œæ–¹æ³•å¼€å§‹æ¥ä»‹ç»åµŒå¥—äº‹åŠ¡æ“ä½œã€‚"><link data-rh="true" rel="icon" href="/gfdoc-md/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://goframe.org/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡"><link data-rh="true" rel="alternate" href="https://goframe.org/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://goframe.org/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/gfdoc-md/blog/rss.xml" title="GoFrame RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/gfdoc-md/blog/atom.xml" title="GoFrame Atom Feed"><link rel="stylesheet" href="/gfdoc-md/assets/css/styles.57a3be69.css">
<script src="/gfdoc-md/assets/js/runtime~main.587a407a.js" defer="defer"></script>
<script src="/gfdoc-md/assets/js/main.490cd04e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="è·³åˆ°ä¸»è¦å†…å®¹"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">è·³åˆ°ä¸»è¦å†…å®¹</a></div><nav aria-label="ä¸»å¯¼èˆª" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="åˆ‡æ¢å¯¼èˆªæ " aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gfdoc-md/"><div class="navbar__logo"><img src="/gfdoc-md/img/favicon.ico" alt="GoFrame Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/gfdoc-md/img/favicon.ico" alt="GoFrame Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">GoFrame</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gfdoc-md/docs/">æ–‡æ¡£</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gogf/gf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="å›åˆ°é¡¶éƒ¨" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="æ–‡æ¡£ä¾§è¾¹æ " class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gfdoc-md/docs/">é¦–é¡µ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/å¿«é€Ÿå¼€å§‹/">å¿«é€Ÿå¼€å§‹</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;å¿«é€Ÿå¼€å§‹&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/æ¡†æ¶è®¾è®¡/">æ¡†æ¶è®¾è®¡</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;æ¡†æ¶è®¾è®¡&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/é¡¹ç›®å¼€å‘/">é¡¹ç›®å¼€å‘</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;é¡¹ç›®å¼€å‘&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/å¼€å‘å·¥å…·/">å¼€å‘å·¥å…·</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;å¼€å‘å·¥å…·&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/">æ ¸å¿ƒç»„ä»¶(ğŸ”¥é‡ç‚¹ğŸ”¥)</a><button aria-label="æŠ˜å ä¾§è¾¹æ åˆ†ç±» &#x27;æ ¸å¿ƒç»„ä»¶(ğŸ”¥é‡ç‚¹ğŸ”¥)&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/å¯¹è±¡ç®¡ç†">å¯¹è±¡ç®¡ç†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/è°ƒè¯•æ¨¡å¼">è°ƒè¯•æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/å‘½ä»¤ç®¡ç†/">å‘½ä»¤ç®¡ç†</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;å‘½ä»¤ç®¡ç†&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/é…ç½®ç®¡ç†/">é…ç½®ç®¡ç†</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;é…ç½®ç®¡ç†&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ—¥å¿—ç»„ä»¶/">æ—¥å¿—ç»„ä»¶</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;æ—¥å¿—ç»„ä»¶&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/é”™è¯¯å¤„ç†/">é”™è¯¯å¤„ç†</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;é”™è¯¯å¤„ç†&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®æ ¡éªŒ/">æ•°æ®æ ¡éªŒ</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;æ•°æ®æ ¡éªŒ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/ç±»å‹è½¬æ¢/">ç±»å‹è½¬æ¢</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;ç±»å‹è½¬æ¢&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/ç¼“å­˜ç®¡ç†/">ç¼“å­˜ç®¡ç†</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;ç¼“å­˜ç®¡ç†&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ¨¡æ¿å¼•æ“/">æ¨¡æ¿å¼•æ“</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;æ¨¡æ¿å¼•æ“&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/">æ•°æ®åº“ORM</a><button aria-label="æŠ˜å ä¾§è¾¹æ åˆ†ç±» &#x27;æ•°æ®åº“ORM&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMä½¿ç”¨é…  ç½®">ORMä½¿ç”¨é…ç½®</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMé“¾å¼æ“ä½œ/">ORMé“¾å¼æ“ä½œ(ğŸ”¥é‡ç‚¹ğŸ”¥)</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;ORMé“¾å¼æ“ä½œ(ğŸ”¥é‡ç‚¹ğŸ”¥)&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMæ–¹æ³•æ“ä½œ-åŸç”Ÿ">ORMæ–¹æ³•æ“ä½œ(åŸç”Ÿ)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/">ORMäº‹åŠ¡å¤„ç†</a><button aria-label="æŠ˜å ä¾§è¾¹æ åˆ†ç±» &#x27;ORMäº‹åŠ¡å¤„ç†&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/ORMäº‹åŠ¡å¤„ç†-å¸¸è§„æ“ä½œ">ORMäº‹åŠ¡å¤„ç†-å¸¸è§„æ“ä½œ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/ORMäº‹åŠ¡å¤„ç†-é—­åŒ…æ“ä½œ">ORMäº‹åŠ¡å¤„ç†-é—­åŒ…æ“ä½œ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹ åŠ¡">ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMç»“æœå¤„ç†/">ORMç»“æœå¤„ç†</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;ORMç»“æœå¤„ç†&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMæ—¶åŒºå¤„ç†">ORMæ—¶åŒºå¤„ç†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMæ¨¡å‹ç”Ÿæˆ">ORMæ¨¡å‹ç”Ÿæˆ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMé«˜çº§ç‰¹æ€§/">ORMé«˜çº§ç‰¹æ€§</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;ORMé«˜çº§ç‰¹æ€§&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMæ¥å£å¼€å‘/">ORMæ¥å£å¼€å‘</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;ORMæ¥å£å¼€å‘&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMä¸Šä¸‹æ–‡å˜é‡">ORMä¸Šä¸‹æ–‡å˜é‡</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMæœ€ä½³å®è·µ/">ORMæœ€ä½³å®è·µ</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;ORMæœ€ä½³å®è·µ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMå¸¸è§é—®é¢˜">ORMå¸¸è§é—®é¢˜</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/NoSQL Redis/">NoSQL Redis</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;NoSQL Redis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/I18Nå›½é™…åŒ–/">I18Nå›½é™…åŒ–</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;I18Nå›½é™…åŒ–&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/èµ„æºç®¡ç†/">èµ„æºç®¡ç†</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;èµ„æºç®¡ç†&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/ç»„ä»¶åˆ—è¡¨/">ç»„ä»¶åˆ—è¡¨</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;ç»„ä»¶åˆ—è¡¨&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/å¾®æœåŠ¡å¼€å‘/">å¾®æœåŠ¡å¼€å‘</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;å¾®æœåŠ¡å¼€å‘&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/WEBæœåŠ¡å¼€å‘/">WEBæœåŠ¡å¼€å‘</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;WEBæœåŠ¡å¼€å‘&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/ç½‘ç»œæœåŠ¡å¼€å‘/">ç½‘ç»œæœåŠ¡å¼€å‘</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;ç½‘ç»œæœåŠ¡å¼€å‘&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/ç‰ˆæœ¬å‘å¸ƒè®°å½•/">ç‰ˆæœ¬å‘å¸ƒè®°å½•</a><button aria-label="å±•å¼€  ä¾§è¾¹æ åˆ†ç±» &#x27;ç‰ˆæœ¬å‘å¸ƒè®°å½•&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/æŠ€æœ¯åˆ†äº«äº¤æµ/">æŠ€æœ¯åˆ†äº«äº¤æµ</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;æŠ€æœ¯åˆ†äº«äº¤æµ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gfdoc-md/docs/æäº¤ä½¿ç”¨æ¡ˆä¾‹">æäº¤ä½¿ç”¨æ¡ˆä¾‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gfdoc-md/docs/å¸¸è§é—®é¢˜-FAQ">å¸¸è§é—®é¢˜(FAQ)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/åŠ å…¥æˆ‘ä»¬/">åŠ å…¥æˆ‘ä»¬</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;åŠ å…¥æˆ‘ä»¬&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/æ”¯æŒæˆ‘ä»¬/">æ”¯æŒæˆ‘ä»¬</a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;æ”¯æŒæˆ‘ä»¬&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/gfdoc-md/docs/å…¶ä»–èµ„æ–™/">å…¶ä»–èµ„æ–™</a><button aria-label="å±•  å¼€ä¾§è¾¹æ åˆ†ç±» &#x27;å…¶ä»–èµ„æ–™&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="é¡µé¢è·¯å¾„"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ä¸»é¡µé¢" class="breadcrumbs__link" href="/gfdoc-md/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/"><span itemprop="name">æ ¸å¿ƒç»„ä»¶(ğŸ”¥é‡ç‚¹ğŸ”¥)</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/"><span itemprop="name">æ•°æ®åº“ORM</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/"><span itemprop="name">ORMäº‹åŠ¡å¤„ç†</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><p>ä» <code>GoFrame ORM</code> æ”¯æŒæ•°æ®åº“åµŒå¥—äº‹åŠ¡ï¼ŒåµŒå¥—äº‹åŠ¡åœ¨ä¸šåŠ¡é¡¹ç›®ä¸­ç”¨å¾—æ¯”è¾ƒå¤šï¼Œç‰¹åˆ«æ˜¯ä¸šåŠ¡æ¨¡å—ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ï¼Œä¿è¯å„ä¸ªä¸šåŠ¡æ¨¡å—çš„æ•°æ®åº“æ“ä½œéƒ½å¤„äºä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå…¶åŸç†æ˜¯é€šè¿‡ä¼ é€’çš„ <code>context</code> ä¸Šä¸‹æ–‡æ¥éšå¼ä¼ é€’å’Œå…³è”åŒä¸€ä¸ªäº‹åŠ¡å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°æ®åº“æœåŠ¡å¾€å¾€å¹¶ä¸æ”¯æŒåµŒå¥—äº‹åŠ¡ï¼Œè€Œæ˜¯ä¾é  <code>ORM</code> ç»„ä»¶å±‚é€šè¿‡ <code>Transaction Save Point</code> ç‰¹æ€§å®ç°çš„ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ <code>Transaction</code> é—­åŒ…æ–¹æ³•æ¥å®ç°åµŒå¥—äº‹åŠ¡æ“ä½œã€‚ä¸ºäº†ä¿è¯æ–‡æ¡£çš„å®Œæ•´æ€§ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œä»ç„¶ä»æœ€åŸºæœ¬çš„äº‹åŠ¡æ“ä½œæ–¹æ³•å¼€å§‹æ¥ä»‹ç»åµŒå¥—äº‹åŠ¡æ“ä½œã€‚</p>
<h1>ä¸€ã€ç¤ºä¾‹SQL</h1>
<p>ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ <code>SQL</code>ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µ <code>id</code> å’Œ <code>name</code>ï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `user` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` int(10) unsigned NOT NULL COMMENT &#x27;ç”¨æˆ·ID&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `name` varchar(45) NOT NULL COMMENT &#x27;ç”¨æˆ·åç§°&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>äºŒã€å¸¸è§„æ“ä½œï¼ˆä¸æ¨èï¼‰</h1>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db := g.DB()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tx, err := db.Begin()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if err = tx.Begin(); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_, err = tx.Model(table).Data(g.Map{&quot;id&quot;: 1, &quot;name&quot;: &quot;john&quot;}).Insert()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if err = tx.Rollback(); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_, err = tx.Model(table).Data(g.Map{&quot;id&quot;: 2, &quot;name&quot;: &quot;smith&quot;}).Insert()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if err = tx.Commit(); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-dbbegin-ä¸-txbegin">1ã€ <code>db.Begin</code> ä¸ <code>tx.Begin</code><a href="#1-dbbegin-ä¸-txbegin" class="hash-link" aria-label="1-dbbegin-ä¸-txbeginçš„ç›´æ¥é“¾æ¥" title="1-dbbegin-ä¸-txbeginçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æˆ‘ä»¬çš„åµŒå¥—äº‹åŠ¡ä¸­å‡ºç°äº† <code>db.Begin</code> å’Œ <code>tx.Begin</code> ä¸¤ç§äº‹åŠ¡å¼€å¯æ–¹å¼ï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ <code>db.Begin</code> æ˜¯åœ¨æ•°æ®åº“æœåŠ¡ä¸ŠçœŸæ­£å¼€å¯ä¸€ä¸ªäº‹åŠ¡æ“ä½œï¼Œå¹¶è¿”å›ä¸€ä¸ªäº‹åŠ¡æ“ä½œå¯¹è±¡ <code>tx</code>ï¼Œéšåæ‰€æœ‰çš„äº‹åŠ¡æ“ä½œéƒ½æ˜¯é€šè¿‡è¯¥ <code>tx</code> äº‹åŠ¡å¯¹è±¡æ¥æ“ä½œç®¡ç†ã€‚ <code>tx.Begin</code> è¡¨ç¤ºåœ¨å½“å‰äº‹åŠ¡æ“ä½œä¸­å¼€å¯åµŒå¥—äº‹åŠ¡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå¯¹åµŒå¥—äº‹åŠ¡çš„ <code>SavePoint</code> é‡‡ç”¨è‡ªåŠ¨å‘½åï¼Œå‘½åæ ¼å¼ä¸º <code>transactionN</code>ï¼Œå…¶ä¸­çš„ <code>N</code> è¡¨ç¤ºåµŒå¥—çš„å±‚çº§æ•°é‡ï¼Œå¦‚æœæ‚¨çœ‹åˆ°æ—¥å¿—ä¸­å‡ºç° <code>SAVEPOINT `transaction1` </code> è¡¨ç¤ºå½“å‰åµŒå¥—å±‚çº§ä¸º <code>2</code>ï¼ˆä» <code>0</code> å¼€å§‹è®¡ç®—ï¼‰ã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2æ›´è¯¦ç»†çš„æ—¥å¿—">2ã€æ›´è¯¦ç»†çš„æ—¥å¿—<a href="#2æ›´è¯¦ç»†çš„æ—¥å¿—" class="hash-link" aria-label="2ã€æ›´è¯¦ç»†çš„æ—¥å¿—çš„ç›´æ¥é“¾æ¥" title="2ã€æ›´è¯¦ç»†çš„æ—¥å¿—çš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p><code>goframe</code> çš„ <code>ORM</code> æ‹¥æœ‰ç›¸å½“å®Œå–„çš„æ—¥å¿—è®°å½•æœºåˆ¶ï¼Œå¦‚æœæ‚¨æ‰“å¼€ <code>SQL</code> æ—¥å¿—ï¼Œé‚£ä¹ˆå°†ä¼šçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ä¿¡æ¯ï¼Œå±•ç¤ºäº†æ•´ä¸ªæ•°æ®åº“è¯·æ±‚çš„è¯¦ç»†æ‰§è¡Œæµç¨‹ï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:12:10.776 [DEBU] [  4 ms] [default] [txid:1] BEGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:12:10.776 [DEBU] [  0 ms] [default] [txid:1] SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:12:10.789 [DEBU] [ 13 ms] [default] [txid:1] SHOW FULL COLUMNS FROM `user`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:12:10.790 [DEBU] [  1 ms] [default] [txid:1] INSERT INTO `user`(`id`,`name`) VALUES(1,&#x27;john&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:12:10.791 [DEBU] [  1 ms] [default] [txid:1] ROLLBACK TO SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:12:10.791 [DEBU] [  0 ms] [default] [txid:1] INSERT INTO `user`(`id`,`name`) VALUES(2,&#x27;smith&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:12:10.792 [DEBU] [  1 ms] [default] [txid:1] COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å…¶ä¸­çš„ <code>[txid:1]</code> è¡¨ç¤º <code>ORM</code> ç»„ä»¶è®°å½•çš„äº‹åŠ¡IDï¼Œå¤šä¸ªçœŸå®çš„äº‹åŠ¡åŒæ—¶æ“ä½œæ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡çš„IDå°†ä¼šä¸åŒã€‚åœ¨åŒä¸€ä¸ªçœŸå®äº‹åŠ¡ä¸‹çš„åµŒå¥—äº‹åŠ¡çš„äº‹åŠ¡IDæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æ‰§è¡ŒåæŸ¥è¯¢æ•°æ®åº“ç»“æœï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; select * from `user`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | name  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  2 | smith |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªæ“ä½œè¢«æˆåŠŸå›æ»šï¼Œåªæœ‰ç¬¬äºŒä¸ªæ“ä½œæ‰§è¡Œå¹¶æäº¤æˆåŠŸã€‚</p>
<h1>ä¸‰ã€é—­åŒ…æ“ä½œ(æ¨è)</h1>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é—­åŒ…æ“ä½œæ¥å®ç°åµŒå¥—äº‹åŠ¡ï¼ŒåŒæ ·ä¹Ÿæ˜¯é€šè¿‡ <code>Transaction</code> æ–¹æ³•å®ç°ã€‚</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// Nested transaction 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if err := tx.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_, err := tx.Model(table).Ctx(ctx).Data(g.Map{&quot;id&quot;: 1, &quot;name&quot;: &quot;john&quot;}).Insert()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// Nested transaction 2, panic.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if err := tx.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_, err := tx.Model(table).Ctx(ctx).Data(g.Map{&quot;id&quot;: 2, &quot;name&quot;: &quot;smith&quot;}).Insert()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		// Create a panic that can make this transaction rollback automatically.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		panic(&quot;error&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>åµŒå¥—äº‹åŠ¡çš„é—­åŒ…åµŒå¥—ä¸­ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨å…¶ä¸­çš„ <code>tx</code> å¯¹è±¡ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ <code>db</code> å¯¹è±¡æˆ–è€… <code>dao</code> åŒ…ï¼Œè¿™ç§æ–¹å¼æ›´å¸¸è§ä¸€äº›ã€‚ç‰¹åˆ«æ˜¯åœ¨æ–¹æ³•å±‚çº§è°ƒç”¨æ—¶ï¼Œä½¿å¾—å¯¹äºå¼€å‘è€…æ¥è¯´å¹¶ä¸ç”¨å…³å¿ƒ <code>tx</code> å¯¹è±¡çš„ä¼ é€’ï¼Œä¹Ÿå¹¶ä¸ç”¨å…³å¿ƒå½“å‰äº‹åŠ¡æ˜¯å¦éœ€è¦åµŒå¥—æ‰§è¡Œï¼Œä¸€åˆ‡éƒ½ç”±ç»„ä»¶è‡ªåŠ¨ç»´æŠ¤ï¼Œæå¤§å‡å°‘å¼€å‘è€…çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚ä½†æ˜¯åŠ¡å¿…è®°å¾—å°† <code>ctx</code> ä¸Šä¸‹æ–‡å˜é‡å±‚å±‚ä¼ é€’ä¸‹å»å“¦ã€‚ä¾‹å¦‚ï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// Nested transaction 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if err := db.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_, err := db.Model(table).Ctx(ctx).Data(g.Map{&quot;id&quot;: 1, &quot;name&quot;: &quot;john&quot;}).Insert()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// Nested transaction 2, panic.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if err := db.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_, err := db.Model(table).Ctx(ctx).Data(g.Map{&quot;id&quot;: 2, &quot;name&quot;: &quot;smith&quot;}).Insert()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		// Create a panic that can make this transaction rollback automatically.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		panic(&quot;error&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å¦‚æœæ‚¨æ‰“å¼€ <code>SQL</code> æ—¥å¿—ï¼Œé‚£ä¹ˆæ‰§è¡Œåå°†ä¼šçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ä¿¡æ¯ï¼Œå±•ç¤ºäº†æ•´ä¸ªæ•°æ®åº“è¯·æ±‚çš„è¯¦ç»†æ‰§è¡Œæµç¨‹ï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:18:46.672 [DEBU] [  2 ms] [default] [txid:1] BEGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:18:46.672 [DEBU] [  0 ms] [default] [txid:1] SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:18:46.673 [DEBU] [  0 ms] [default] [txid:1] SHOW FULL COLUMNS FROM `user`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:18:46.674 [DEBU] [  0 ms] [default] [txid:1] INSERT INTO `user`(`id`,`name`) VALUES(1,&#x27;john&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:18:46.674 [DEBU] [  0 ms] [default] [txid:1] RELEASE SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:18:46.675 [DEBU] [  1 ms] [default] [txid:1] SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:18:46.675 [DEBU] [  0 ms] [default] [txid:1] INSERT INTO `user`(`name`,`id`) VALUES(&#x27;smith&#x27;,2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:18:46.675 [DEBU] [  0 ms] [default] [txid:1] ROLLBACK TO SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:18:46.676 [DEBU] [  1 ms] [default] [txid:1] ROLLBACK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å‡å¦‚ <code>ctx</code> ä¸Šä¸‹æ–‡å˜é‡æ²¡æœ‰å±‚å±‚ä¼ é€’ä¸‹å»ï¼Œé‚£ä¹ˆåµŒå¥—äº‹åŠ¡å°†ä¼šå¤±è´¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé”™è¯¯çš„ä¾‹å­ï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// Nested transaction 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if err := db.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_, err := db.Model(table).Ctx(ctx).Data(g.Map{&quot;id&quot;: 1, &quot;name&quot;: &quot;john&quot;}).Insert()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// Nested transaction 2, panic.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if err := db.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_, err := db.Model(table).Data(g.Map{&quot;id&quot;: 2, &quot;name&quot;: &quot;smith&quot;}).Insert()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		// Create a panic that can make this transaction rollback automatically.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		panic(&quot;error&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>æ‰“å¼€ <code>SQL</code> æ‰§è¡Œæ—¥å¿—ï¼Œæ‰§è¡Œåï¼Œæ‚¨å°†ä¼šçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—å†…å®¹ï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:29:38.841 [DEBU] [  3 ms] [default] [txid:1] BEGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:29:38.842 [DEBU] [  1 ms] [default] [txid:1] SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:29:38.843 [DEBU] [  1 ms] [default] [txid:1] SHOW FULL COLUMNS FROM `user`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:29:38.845 [DEBU] [  2 ms] [default] [txid:1] INSERT INTO `user`(`id`,`name`) VALUES(1,&#x27;john&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:29:38.845 [DEBU] [  0 ms] [default] [txid:1] RELEASE SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:29:38.846 [DEBU] [  1 ms] [default] [txid:1] SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:29:38.847 [DEBU] [  1 ms] [default] INSERT INTO `user`(`id`,`name`) VALUES(2,&#x27;smith&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:29:38.848 [DEBU] [  0 ms] [default] [txid:1] ROLLBACK TO SAVEPOINT `transaction0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:29:38.848 [DEBU] [  0 ms] [default] [txid:1] ROLLBACK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¡ <code>INSERT</code> æ“ä½œ <code>INSERT INTO `user`(`id`,`name`) VALUES(2,&#x27;smith&#x27;) </code> æ²¡æœ‰äº‹åŠ¡IDæ‰“å°ï¼Œè¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨åˆ°äº‹åŠ¡ï¼Œé‚£ä¹ˆè¯¥æ“ä½œå°†ä¼šè¢«çœŸæ­£æäº¤åˆ°æ•°æ®åº“æ‰§è¡Œï¼Œå¹¶ä¸èƒ½è¢«å›æ»šã€‚</p>
<h1>å››ã€ <code>SavePoint/RollbackTo</code></h1>
<p>å¼€å‘è€…ä¹Ÿå¯ä»¥çµæ´»ä½¿ç”¨ <code>Transaction Save Point</code> ç‰¹æ€§ï¼Œå¹¶å®ç°è‡ªå®šä¹‰çš„ <code>SavePoint</code> å‘½åä»¥åŠæŒ‡å®š <code>Point</code> å›æ»šæ“ä½œã€‚</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tx, err := db.Begin()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">defer func() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if err := recover(); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_ = tx.Rollback()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if _, err = tx.Model(table).Data(g.Map{&quot;id&quot;: 1, &quot;name&quot;: &quot;john&quot;}).Insert(); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if err = tx.SavePoint(&quot;MyPoint&quot;); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if _, err = tx.Model(table).Data(g.Map{&quot;id&quot;: 2, &quot;name&quot;: &quot;smith&quot;}).Insert(); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if _, err = tx.Model(table).Data(g.Map{&quot;id&quot;: 3, &quot;name&quot;: &quot;green&quot;}).Insert(); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if err = tx.RollbackTo(&quot;MyPoint&quot;); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if err = tx.Commit(); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	panic(err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å¦‚æœæ‚¨æ‰“å¼€ <code>SQL</code> æ—¥å¿—ï¼Œé‚£ä¹ˆå°†ä¼šçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ä¿¡æ¯ï¼Œå±•ç¤ºäº†æ•´ä¸ªæ•°æ®åº“è¯·æ±‚çš„è¯¦ç»†æ‰§è¡Œæµç¨‹ï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:38:51.992 [DEBU] [  3 ms] [default] [txid:1] BEGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:38:52.002 [DEBU] [  9 ms] [default] [txid:1] SHOW FULL COLUMNS FROM `user`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:38:52.002 [DEBU] [  0 ms] [default] [txid:1] INSERT INTO `user`(`id`,`name`) VALUES(1,&#x27;john&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:38:52.003 [DEBU] [  1 ms] [default] [txid:1] SAVEPOINT `MyPoint`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:38:52.004 [DEBU] [  1 ms] [default] [txid:1] INSERT INTO `user`(`id`,`name`) VALUES(2,&#x27;smith&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:38:52.005 [DEBU] [  1 ms] [default] [txid:1] INSERT INTO `user`(`id`,`name`) VALUES(3,&#x27;green&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:38:52.006 [DEBU] [  0 ms] [default] [txid:1] ROLLBACK TO SAVEPOINT `MyPoint`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-05-22 21:38:52.006 [DEBU] [  0 ms] [default] [txid:1] COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>æ‰§è¡ŒåæŸ¥è¯¢æ•°æ®åº“ç»“æœï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; select * from `user`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id | name |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  1 | john |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡åœ¨ç¬¬ä¸€ä¸ª <code>Insert</code> æ“ä½œåä¿å­˜äº†ä¸€ä¸ª <code>SavePoint</code> åç§° <code>MyPoint</code>ï¼Œéšåçš„å‡ æ¬¡æ“ä½œéƒ½é€šè¿‡ <code>RollbackTo</code> æ–¹æ³•è¢«å›æ»šæ‰äº†ï¼Œå› æ­¤åªæœ‰ç¬¬ä¸€æ¬¡ <code>Insert</code> æ“ä½œè¢«æˆåŠŸæäº¤æ‰§è¡Œã€‚</p>
<h1>äº”ã€åµŒå¥—äº‹åŠ¡åœ¨å·¥ç¨‹ä¸­çš„å‚è€ƒç¤ºä¾‹</h1>
<p>ä¸ºäº†ç®€åŒ–ç¤ºä¾‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ç”¨æˆ·æ¨¡å—ç›¸å…³çš„ç¤ºä¾‹ï¼Œä¾‹å¦‚ç”¨æˆ·æ³¨å†Œï¼Œé€šè¿‡äº‹åŠ¡æ“ä½œä¿å­˜ç”¨æˆ·åŸºæœ¬ä¿¡æ¯( <code>user</code>)ã€è¯¦ç»†ä¿¡æ¯( <code>user_detail</code>)ä¸¤ä¸ªè¡¨ï¼Œä»»ä¸€ä¸ªè¡¨æ“ä½œå¤±è´¥æ•´ä¸ªæ³¨å†Œæ“ä½œéƒ½å°†å¤±è´¥ã€‚ä¸ºå±•ç¤ºåµŒå¥—äº‹åŠ¡æ•ˆæœï¼Œæˆ‘ä»¬å°†ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ç®¡ç†å’Œç”¨æˆ·è¯¦ç»†ä¿¡æ¯ç®¡ç†åˆ’åˆ†ä¸ºäº†ä¸¤ä¸ª <code>dao</code> å¯¹è±¡ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬çš„é¡¹ç›®æŒ‰ç…§ <code>goframe</code> æ ‡å‡†é¡¹ç›®å·¥ç¨‹åŒ–åˆ†ä¸ºä¸‰å±‚ <code>api-service-dao</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„åµŒå¥—äº‹åŠ¡æ“ä½œå¯èƒ½æ˜¯è¿™æ ·çš„ã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="controller"><code>controller</code><a href="#controller" class="hash-link" aria-label="controllerçš„ç›´æ¥é“¾æ¥" title="controllerçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ç”¨æˆ·æ³¨å†ŒHTTPæ¥å£</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (*cUser) Signup(r *ghttp.Request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	service.User().Signup(r.Context(), userServiceSignupReq)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>æ‰¿æ¥HTTPè¯·æ±‚ï¼Œå¹¶ä¸”å°† <code>Context</code> ä¸Šä¸‹æ–‡è¾¹å˜é‡ä¼ é€’ç»™åç»­çš„æµç¨‹ã€‚</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="service"><code>service</code><a href="#service" class="hash-link" aria-label="serviceçš„ç›´æ¥é“¾æ¥" title="serviceçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ç”¨æˆ·æ³¨å†Œä¸šåŠ¡é€»è¾‘å¤„ç†</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (*userService) Signup(ctx context.Context, r *model.UserServiceSignupReq) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	dao.User.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		err := dao.User.Ctx(ctx).Save(r.UserInfo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		err := dao.UserDetail.Ctx(ctx).Save(r.UserDetail)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå†…éƒ¨çš„ <code>user</code> è¡¨å’Œ <code>user_detail</code> è¡¨ä½¿ç”¨äº†åµŒå¥—äº‹åŠ¡æ¥ç»Ÿä¸€æ‰§è¡Œäº‹åŠ¡æ“ä½œã€‚æ³¨æ„åœ¨é—­åŒ…å†…éƒ¨éœ€è¦é€šè¿‡ <code>Ctx</code> æ–¹æ³•å°†ä¸Šä¸‹æ–‡å˜é‡ä¼ é€’ç»™ä¸‹ä¸€å±‚çº§ã€‚å‡å¦‚åœ¨é—­åŒ…ä¸­å­˜åœ¨å¯¹å…¶ä»– <code>service</code> å¯¹è±¡çš„è°ƒç”¨ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦å°† <code>ctx</code> å˜é‡ä¼ é€’è¿‡å»ï¼Œä¾‹å¦‚ï¼š</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func (*userService) Signup(ctx context.Context, r *model.UserServiceSignupReq) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	dao.User.Transaction(ctx, func(ctx context.Context, tx gdb.Tx) (err error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err = dao.User.Ctx(ctx).Save(r.UserInfo); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err = dao.UserDetail.Ctx(ctx).Save(r.UserDetail); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err = service.XXXA().Call(ctx, ...); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err = service.XXXB().Call(ctx, ...); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err = service.XXXC().Call(ctx, ...); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dao"><code>dao</code><a href="#dao" class="hash-link" aria-label="daoçš„ç›´æ¥é“¾æ¥" title="daoçš„ç›´æ¥é“¾æ¥">â€‹</a></h2>
<p><code>dao</code> å±‚çš„ä»£ç ç”± <code>goframe cli</code> å·¥å…·å…¨è‡ªåŠ¨åŒ–ç”ŸæˆåŠç»´æŠ¤å³å¯ã€‚</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/hailaz/gfdoc-md/blob/main/docs/4-æ ¸å¿ƒç»„ä»¶/10-æ•°æ®åº“ORM/3-ORMäº‹åŠ¡å¤„ç†/2-ORMäº‹åŠ¡å¤„ç†-åµŒå¥—äº‹åŠ¡.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡ä»¶é€‰é¡¹å¡"><a class="pagination-nav__link pagination-nav__link--prev" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMäº‹åŠ¡å¤„ç†/ORMäº‹åŠ¡å¤„ç†-é—­åŒ…æ“ä½œ"><div class="pagination-nav__sublabel">ä¸Šä¸€é¡µ</div><div class="pagination-nav__label">ORMäº‹åŠ¡å¤„ç†-é—­åŒ…æ“ä½œ</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/gfdoc-md/docs/æ ¸å¿ƒç»„ä»¶/æ•°æ®åº“ORM/ORMç»“æœå¤„ç†/"><div class="pagination-nav__sublabel">ä¸‹ä¸€é¡µ</div><div class="pagination-nav__label">ORMç»“æœå¤„ç†</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-dbbegin-ä¸-txbegin" class="table-of-contents__link toc-highlight">1ã€ <code>db.Begin</code> ä¸ <code>tx.Begin</code></a></li><li><a href="#2æ›´è¯¦ç»†çš„æ—¥å¿—" class="table-of-contents__link toc-highlight">2ã€æ›´è¯¦ç»†çš„æ—¥å¿—</a></li><li><a href="#controller" class="table-of-contents__link toc-highlight"><code>controller</code></a></li><li><a href="#service" class="table-of-contents__link toc-highlight"><code>service</code></a></li><li><a href="#dao" class="table-of-contents__link toc-highlight"><code>dao</code></a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>